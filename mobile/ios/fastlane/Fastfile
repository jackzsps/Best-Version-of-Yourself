default_platform(:ios)

platform :ios do
  desc "Build and deploy to TestFlight (Internal testers)"
  lane :beta do
    # Assuming the CI environment provides Apple ID login tokens via ASC API Key
    # app_store_connect_api_key(
    #   key_id: ENV["ASC_KEY_ID"],
    #   issuer_id: ENV["ASC_ISSUER_ID"],
    #   key_filepath: ENV["ASC_KEY_FILEPATH"],
    #   in_house: false
    # )

    increment_build_number(
      build_number: ENV["GITHUB_RUN_NUMBER"] || "1"
    )

    # Note: match or sigh will need to be configured for provisioning profiles
    # match(type: "appstore")

    gym(
      scheme: "BestVersionOfYourself",
      workspace: "BestVersionOfYourself.xcworkspace",
      clean: true,
      export_method: "app-store"
    )

    # Uploads to TestFlight
    # pilot(
    #   skip_waiting_for_build_processing: true
    # )
  end
end
