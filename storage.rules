rules_version = '2';

// Firebase Storage Rules
// These rules secure your user's files by ensuring that
// only an authenticated user can access their own data.
service firebase.storage {
  match /b/{bucket}/o {

    // Rule for user-specific image uploads
    // Path: /users/{userId}/images/{imageId}
    match /users/{userId}/images/{imageId} {
      // Allow read and write ONLY if the user is authenticated
      // and their UID matches the path.
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Rule for user-specific archived data
    // Path: /archive/{userId}/{fileId}
    match /archive/{userId}/{fileId} {
      // Allow ONLY read access if the user is authenticated
      // and their UID matches the path.
      // Write access should be restricted to backend/cloud functions.
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if false; // Explicitly deny client-side writes
    }
  }
}
